#!/bin/bash

##
# Used alacritty hints to openv files in an existing nvim instance.
##

# convert python stack reference to file:line
file=$(echo "$@" | perl -pe 's|\s*File "(.*)", line (\d+),.*|\1:\2|')

pid=$(
  ps -ef |
    grep "$(whoami) .*[n]vim --embed" |
    grep -v "macros/less.vim" |
    cut -d ' ' -f3 |
    head -1
)
server=$(ls -1tr /run/user/$(id -u)/nvim.$pid.0)
if [ -n "$server" ]; then
  nvim --server $server --remote-send "<c-\><c-n>:split $file<cr>"
fi
